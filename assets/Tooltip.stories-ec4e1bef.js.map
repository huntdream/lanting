{"version":3,"file":"Tooltip.stories-ec4e1bef.js","sources":["../../src/components/Tooltip/Tip.tsx","../../src/components/Tooltip/index.tsx"],"sourcesContent":["import React, { ReactNode, useEffect, useRef, useState } from 'react';\nimport cls from 'classnames';\nimport './style.scss';\n\nexport type Placement = 'top' | 'right' | 'bottom' | 'left';\n\ninterface Props {\n  title: ReactNode;\n  rect: DOMRect;\n  placement?: Placement;\n  isClosing?: boolean;\n  onClose: () => void;\n}\n\nconst Tip: React.FC<Props> = ({\n  title,\n  rect,\n  placement = 'top',\n  isClosing,\n  onClose,\n}) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const [transform, setTransform] = useState('');\n\n  useEffect(() => {\n    const oberver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        if (entry.contentRect) {\n          calcPosition();\n        }\n      }\n    });\n\n    if (ref.current) {\n      oberver.observe(ref.current);\n    }\n\n    return () => oberver.disconnect();\n  }, [placement]);\n\n  useEffect(() => {\n    const handleClose = () => {\n      onClose();\n    };\n\n    if (ref.current && isClosing) {\n      ref.current.addEventListener('animationend', handleClose);\n    }\n\n    return () => ref.current?.removeEventListener('animationend', handleClose);\n  }, [isClosing]);\n\n  const calcPosition = () => {\n    if (!ref.current) return;\n    const { width, left, top, height } = rect;\n\n    const coorX = window.scrollX + left;\n    const coorY = window.scrollY + top;\n    const { width: w, height: h } = ref.current.getBoundingClientRect();\n\n    let x = coorX;\n    let y = coorY;\n\n    switch (placement) {\n      case 'right':\n        x = coorX + width;\n        y = coorY + height / 2 - h / 2;\n        break;\n      case 'bottom':\n        x = coorX + width / 2 - w / 2;\n        y = coorY + height;\n\n        break;\n      case 'left':\n        x = coorX - w;\n        y = coorY + height / 2 - h / 2;\n\n        break;\n      default:\n        x = coorX + width / 2 - w / 2;\n        y = coorY - h;\n        break;\n    }\n\n    x = Math.max(0, x);\n    y = Math.max(0, y);\n\n    setTransform(`translate(${x}px, ${y}px)`);\n  };\n\n  return (\n    <div\n      className={cls(\n        'lanting-tooltip-container',\n        `lanting-tooltip--${placement}`\n      )}\n      ref={ref}\n      style={{\n        transform,\n      }}\n    >\n      <div\n        className={cls('lanting-tooltip-content', {\n          'lanting-tooltip-content--fadeOut': isClosing,\n        })}\n      >\n        {title}\n      </div>\n    </div>\n  );\n};\n\nexport default Tip;\n","import React, {\n  MouseEvent,\n  ReactElement,\n  ReactNode,\n  isValidElement,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\nimport './style.scss';\nimport Tip, { Placement } from './Tip';\n\ninterface Props {\n  title?: ReactNode;\n  timeout?: number;\n  children: ReactElement;\n  placement?: Placement;\n}\n\nconst Tooltip: React.FC<Props> = ({\n  children,\n  title,\n  timeout = 0,\n  placement,\n}) => {\n  const timer = useRef<number>(0);\n  const [visible, setVisible] = useState(false);\n  const [rect, setRect] = useState<DOMRect>();\n  const [isClosing, setIsClosing] = useState(false);\n\n  const child = React.Children.only(children) as React.ReactElement;\n  const originChildProps = child?.props || {};\n\n  const handleEnter = (event: MouseEvent) => {\n    setIsClosing(false);\n\n    if (!visible) {\n      const target = event.currentTarget as HTMLElement;\n\n      setRect(target.getBoundingClientRect());\n\n      if (timeout > 0) {\n        timer.current = window.setTimeout(() => {\n          setVisible(true);\n        }, timeout);\n      } else {\n        setVisible(true);\n      }\n    }\n  };\n\n  const handleClose = () => {\n    setVisible(false);\n    setRect(undefined);\n  };\n\n  const handleLeave = (event: MouseEvent) => {\n    setIsClosing(true);\n\n    if (timer.current) {\n      clearTimeout(timer.current);\n    }\n  };\n\n  const handleMouseEnter = (event: MouseEvent) => {\n    handleEnter(event);\n    originChildProps?.onMouseEnter?.(event);\n  };\n\n  const handleMouseLeave = (event: MouseEvent) => {\n    handleLeave(event);\n    originChildProps?.onMouseLeave?.(event);\n  };\n\n  const handleTouchStart = (event: MouseEvent) => {\n    handleEnter(event);\n    originChildProps?.onTouchStart?.(event);\n  };\n\n  const handleTouchEnd = (event: MouseEvent) => {\n    handleLeave(event);\n    originChildProps?.onTouchEnd?.(event);\n  };\n\n  const childProps = {\n    onMouseEnter: handleMouseEnter,\n    onMouseLeave: handleMouseLeave,\n    onTouchStart: handleTouchStart,\n    onTouchEnd: handleTouchEnd,\n  };\n\n  const trigger =\n    isValidElement(children) && React.cloneElement(children, childProps);\n\n  return (\n    <>\n      {trigger}\n      {visible &&\n        rect &&\n        createPortal(\n          <Tip\n            title={title}\n            rect={rect}\n            isClosing={isClosing}\n            placement={placement}\n            onClose={handleClose}\n          />,\n          document.body\n        )}\n    </>\n  );\n};\n\nexport default Tooltip;\n"],"names":["Tip","title","rect","placement","isClosing","onClose","ref","useRef","transform","setTransform","useState","useEffect","oberver","entries","entry","calcPosition","handleClose","_a","width","left","top","height","coorX","coorY","w","h","x","y","jsx","cls","Tooltip","children","timeout","timer","visible","setVisible","setRect","setIsClosing","child","React","originChildProps","handleEnter","event","target","handleLeave","childProps","trigger","isValidElement","jsxs","Fragment","createPortal"],"mappings":"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"}