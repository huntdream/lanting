{"version":3,"sources":["components/Apollo/index.tsx","components/Post/index.tsx","containers/Index/index.tsx","components/LantingEditor/StyleControls/StyleButton.tsx","components/Icon/index.tsx","components/LantingEditor/StyleControls/BlockStyle.tsx","components/LantingEditor/StyleControls/InlineStyle.tsx","components/LantingEditor/StyleControls/index.tsx","components/LantingEditor/Decorator/index.tsx","components/LantingEditor/Decorator/PrismDecorator.tsx","components/LantingEditor/BlockRenderMap/Code/index.tsx","components/LantingEditor/BlockRenderMap/index.tsx","components/LantingEditor/utils/getCurrentBlock.tsx","components/LantingEditor/utils/hasSelectionInBlock.tsx","components/LantingEditor/utils/index.tsx","components/LantingEditor/utils/onTabInCode.tsx","components/LantingEditor/utils/hidePlaceholder.tsx","components/LantingEditor/utils/convertToState.tsx","components/LantingEditor/BlockStyleFn/index.tsx","components/LantingEditor/BlockRenderer/index.tsx","components/LantingEditor/index.tsx","components/LantingEditor/helpers.ts","containers/Edit/index.tsx","components/Nav/index.tsx","containers/App/index.tsx","index.tsx"],"names":["client","ApolloClient","uri","Apollo","children","Post","className","Index","range","map","item","key","StyleButton","active","label","onToggle","onMouseDown","event","preventDefault","cls","Icon","style","props","onClick","styleMap","BlockStyle","editorState","onChange","selection","getSelection","blockType","getCurrentContent","getBlockForKey","getStartKey","getType","toLowerCase","RichUtils","toggleBlockType","handleBlockStyleToggle","InlineStyle","inlineTypes","getCurrentInlineStyle","has","inlineType","toggleInlineStyle","StyleControls","decorators","this","highlighted","block","contentState","offset","tokenCount","type","text","getText","blockKey","getKey","decorations","Array","length","fill","includes","Immutable","List","preClassName","document","querySelector","lang","exec","tokens","Prism","tokenize","languages","getLang","processToken","token","tokenId","resultId","targetArr","start","end","componentKey","ii","occupySlice","childOffset","i","content","childToken","split","LANGS","syntax","Code","useState","selectedLang","setSelectedLang","contentEditable","value","target","customBlockRender","Map","wrapper","blockRenderMap","DefaultDraftBlockRenderMap","merge","getCurrentBlock","startKey","hasSelectionInBlock","utils","onTabInCode","newState","isCollapsed","Draft","Modifier","insertText","replaceText","EditorState","push","hidePlaceholder","hasText","getBlockMap","first","convertToState","JSON","parse","console","log","createWithContent","convertFromRaw","e","blocksFromHTML","convertFromHTML","state","ContentState","createFromBlockArray","contentBlocks","entityMap","blockStyleFn","contentBlock","blockRenderer","LantingEditor","rawContent","editorRef","useRef","EmptyState","createEmpty","readOnly","x","y","setEditorState","useEffect","focusEditor","Prismjs","highlightAll","current","focus","handleStateChange","convertToRaw","getSelectionCoords","selectionRange","window","rangeCount","getRangeAt","getSelectionRange","editorBounds","getElementById","getBoundingClientRect","startOffset","endOffset","selectionBounds","right","left","top","handleMouseUp","useCallback","classnames","id","ref","placeholder","onFocus","addEventListener","onBlur","removeEventListener","onTab","blockRendererFn","handleKeyCommand","command","handleReturn","currentBlock","insertSoftNewline","Edit","Nav","pathname","useLocation","isEditPage","useMemo","classNames","to","App","localStorage","setItem","path","exact","component","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.b9b58539.chunk.js","sourcesContent":["import React from 'react';\nimport { ApolloProvider } from '@apollo/react-hooks';\nimport ApolloClient from 'apollo-boost';\n\ninterface ApolloProps {}\n\nconst client = new ApolloClient({\n  uri: 'http://localhost:4000',\n});\n\nconst Apollo: React.FC<ApolloProps> = ({ children }) => {\n  return <ApolloProvider client={client}>{children}</ApolloProvider>;\n};\n\nexport default Apollo;\n","import React from 'react';\nimport './style.scss';\n\ninterface PostProps {}\n\nconst Post: React.FC<PostProps> = () => {\n  return (\n    <article className='lanting-post'>\n      <header className='lanting-post-header'>\n        <h3 className='lanting-post-title'>兰亭集序</h3>\n      </header>\n      <main className='lanting-post-content'>仰观宇宙之大，俯察品类之盛</main>\n      <footer className='lanting-post-footer'>2020年07月08日15:58:23</footer>\n    </article>\n  );\n};\n\nexport default Post;\n","import React, { useEffect } from 'react';\nimport { range } from 'lodash';\nimport './style.scss';\nimport Post from 'components/Post';\n\ninterface IndexProps {}\n\nconst Index: React.FC<IndexProps> = () => {\n  return (\n    <div className='index'>\n      {range(10).map((item) => (\n        <Post key={item} />\n      ))}\n    </div>\n  );\n};\n\nexport default Index;\n","import React, { MouseEvent, ReactNode } from 'react';\nimport cls from 'classnames';\nimport './style.scss';\n\ninterface StyleButtonProps {\n  active: boolean;\n  className?: string;\n  label: ReactNode | string;\n  onToggle: () => void;\n}\n\nconst StyleButton: React.FC<StyleButtonProps> = ({\n  active,\n  className,\n  label,\n  onToggle,\n}) => {\n  const onMouseDown = (event: MouseEvent) => {\n    event.preventDefault();\n    onToggle();\n  };\n\n  return (\n    <div\n      onMouseDown={onMouseDown}\n      className={cls(\n        'stylecontrols-button',\n        {\n          'stylecontrols-button--active': active,\n        },\n        className\n      )}\n    >\n      {label}\n    </div>\n  );\n};\n\nexport default StyleButton;\n","import React, { CSSProperties, HTMLAttributes } from 'react';\nimport cls from 'classnames';\n\ninterface IconProps extends HTMLAttributes<HTMLElement> {\n  className?: string;\n  style?: CSSProperties;\n  children: string;\n}\n\nconst Icon: React.FC<IconProps> = ({\n  className,\n  children,\n  style,\n  onClick,\n  ...props\n}) => {\n  return (\n    <i\n      className={cls('material-icons', 'lanting-icon--clickable', className)}\n      style={style}\n      {...props}\n    >\n      {children}\n    </i>\n  );\n};\n\nexport default Icon;\n","import React from 'react';\nimport './style.scss';\nimport StyleButton from './StyleButton';\nimport { EditorState, RichUtils } from 'draft-js';\nimport Icon from 'components/Icon';\n\ninterface BlockStyleProps {\n  editorState: EditorState;\n  onChange: (editorState: EditorState) => void;\n}\n\nconst styleMap = [\n  { label: 'H1', style: 'header-one' },\n  { label: 'H2', style: 'header-two' },\n  { label: 'H3', style: 'header-three' },\n  { label: <Icon>format_quote</Icon>, style: 'blockquote' },\n  { label: <Icon>format_list_bulleted</Icon>, style: 'unordered-list-item' },\n  { label: <Icon>format_list_numbered</Icon>, style: 'ordered-list-item' },\n  {\n    label: <Icon>code</Icon>,\n    style: 'code-block',\n  },\n];\n\nconst BlockStyle: React.FC<BlockStyleProps> = ({ editorState, onChange }) => {\n  const selection = editorState.getSelection();\n  const blockType = editorState\n    .getCurrentContent()\n    .getBlockForKey(selection.getStartKey())\n    .getType();\n\n  const handleBlockStyleToggle = (blockType: string) => {\n    onChange(RichUtils.toggleBlockType(editorState, blockType));\n  };\n\n  return (\n    <div className='stylecontrols-block'>\n      {styleMap.map(({ label, style }) => (\n        <StyleButton\n          active={style === blockType}\n          className={`stylecontrols-${style.toLowerCase()}`}\n          key={style}\n          label={label}\n          onToggle={() => handleBlockStyleToggle(style)}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default BlockStyle;\n","import React from 'react';\nimport './style.scss';\nimport StyleButton from './StyleButton';\nimport { EditorState, RichUtils } from 'draft-js';\nimport Icon from 'components/Icon';\n\ninterface InlineStyleProps {\n  editorState: EditorState;\n  onChange: (editorState: EditorState) => void;\n}\n\nconst styleMap = [\n  { label: <Icon>format_bold</Icon>, style: 'BOLD' },\n  { label: <Icon>format_italic</Icon>, style: 'ITALIC' },\n  { label: <Icon>format_underline</Icon>, style: 'UNDERLINE' },\n  { label: <Icon>format_strikethrough</Icon>, style: 'STRIKETHROUGH' },\n];\n\nconst InlineStyle: React.FC<InlineStyleProps> = ({ editorState, onChange }) => {\n  const inlineTypes = editorState.getCurrentInlineStyle();\n\n  const handleInlineStyleToggle = (inlineType: string) => {\n    onChange(RichUtils.toggleInlineStyle(editorState, inlineType));\n  };\n\n  return (\n    <div className='stylecontrols-block'>\n      {styleMap.map(({ label, style }) => (\n        <StyleButton\n          active={inlineTypes.has(style)}\n          key={style}\n          label={label}\n          onToggle={() => handleInlineStyleToggle(style)}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default InlineStyle;\n","import React from 'react';\nimport './style.scss';\nimport BlockStyle from './BlockStyle';\nimport { EditorState } from 'draft-js';\nimport InlineStyle from './InlineStyle';\n\ninterface StyleControlsProps {\n  editorState: EditorState;\n  onChange: (editorState: EditorState) => void;\n}\n\nconst StyleControls: React.FC<StyleControlsProps> = ({\n  editorState,\n  onChange,\n}) => {\n  return (\n    <div className='stylecontrols'>\n      <BlockStyle editorState={editorState} onChange={onChange} />\n      <InlineStyle editorState={editorState} onChange={onChange} />\n    </div>\n  );\n};\n\nexport default StyleControls;\n","import PrismDecorator from './PrismDecorator';\n\nconst decorators = new PrismDecorator();\n\nexport default decorators;\n","import { ContentBlock, ContentState } from 'draft-js';\nimport Prism from 'prismjs';\nimport React from 'react';\nimport Immutable from 'immutable';\n\ninterface PrismDecorator {\n  highlighted: {\n    [key: string]: any;\n  };\n}\n\nfunction getLang(lang: string) {\n  if (lang && Prism.languages[lang]) {\n    return Prism.languages[lang];\n  }\n\n  return Prism.languages['javascript'];\n}\n\nfunction occupySlice(\n  targetArr: any,\n  start: number,\n  end: number,\n  componentKey: string\n) {\n  for (var ii = start; ii < end; ii++) {\n    targetArr[ii] = componentKey;\n  }\n}\n\nclass PrismDecorator {\n  constructor() {\n    this.highlighted = {};\n  }\n\n  getDecorations(\n    block: ContentBlock,\n    contentState: ContentState\n  ): Immutable.List<string> {\n    let offset = 0,\n      tokenCount = 0;\n\n    const type = block.getType();\n    const text = block.getText();\n    const blockKey = block.getKey();\n\n    const decorations: Array<string> = Array(text.length).fill(null);\n\n    if (!['code-block'].includes(type)) return Immutable.List(decorations);\n    const preClassName = document.querySelector('pre[class*=language-]')\n      ?.className;\n\n    const lang = preClassName\n      ? /(?<=language-)\\w+$/.exec(preClassName)\n      : ['javascript'];\n\n    const tokens = Prism.tokenize(text, getLang(lang ? lang[0] : ''));\n\n    this.highlighted[blockKey] = {};\n\n    const processToken = (\n      decorations: Array<string>,\n      token: Prism.Token | string,\n      offset: number\n    ) => {\n      if (typeof token === 'string') {\n        return;\n      }\n\n      const tokenId = 'tk' + tokenCount++;\n      const resultId = blockKey + '-' + tokenId;\n\n      this.highlighted[blockKey][tokenId] = token;\n      occupySlice(decorations, offset, offset + token.length, resultId);\n\n      let childOffset = offset;\n      for (let i = 0; i < token.content.length; i++) {\n        const childToken = (token.content as string)[i];\n        processToken(decorations, childToken, childOffset);\n        childOffset += childToken.length;\n      }\n    };\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n      processToken(decorations, token, offset);\n      offset += token.length;\n    }\n\n    return Immutable.List(decorations);\n  }\n\n  getComponentForKey(key: string): Function {\n    return (props: { type: any; children: React.ReactNode }) => (\n      <span className={`token ${props.type}`}>{props.children}</span>\n    );\n  }\n\n  getPropsForKey(key: string): any {\n    const [blockKey, tokenId] = key.split('-');\n    const token = this.highlighted[blockKey][tokenId];\n\n    return {\n      type: token.type,\n    };\n  }\n}\n\nexport default PrismDecorator;\n","import React, { useState, ChangeEvent } from 'react';\nimport './style.scss';\nimport Icon from 'components/Icon';\n\ninterface CodeProps {}\n\ninterface Lang {\n  label: string;\n  syntax: string;\n}\n\nconst LANGS: Lang[] = [\n  { label: 'Javascript', syntax: 'javascript' },\n  { label: 'CSS', syntax: 'css' },\n  { label: 'HTML', syntax: 'html' },\n  { label: 'Golang', syntax: 'golang' },\n  { label: 'C', syntax: 'c' },\n  { label: 'C++', syntax: 'cpp' },\n  { label: 'Bash', syntax: 'bas' },\n  { label: 'Java', syntax: 'java' },\n  { label: 'Typescript', syntax: 'ts' },\n  { label: 'React JSX ', syntax: 'jsx' },\n  { label: 'React TSX', syntax: 'tsx' },\n  { label: 'Git', syntax: 'git' },\n  { label: 'Json', syntax: 'json' },\n];\n\nconst Code: React.FC<CodeProps> = ({ children, ...props }) => {\n  const [selectedLang, setSelectedLang] = useState('javascript');\n\n  const handleLangChange = (event: ChangeEvent<HTMLSelectElement>) => {\n    setSelectedLang(event.target.value);\n  };\n\n  return (\n    <div className='prismjscode'>\n      <div className='prismjscode-header' contentEditable={false}>\n        <select\n          className='prismjscode-switch'\n          value={selectedLang}\n          onChange={handleLangChange}\n        >\n          {LANGS.map((lang) => (\n            <option value={lang.syntax} key={lang.syntax}>\n              {lang.label}\n            </option>\n          ))}\n        </select>\n        <Icon>description</Icon>\n      </div>\n      <pre className={`language-${selectedLang}`}>\n        <code {...props}>{children}</code>\n      </pre>\n    </div>\n  );\n};\n\nexport default Code;\n","import React from 'react';\nimport { Map } from 'immutable';\nimport { DefaultDraftBlockRenderMap } from 'draft-js';\nimport Code from './Code';\n\nconst customBlockRender = Map({\n  'code-block': {\n    wrapper: <Code />,\n  },\n});\n\nconst blockRenderMap = DefaultDraftBlockRenderMap.merge(customBlockRender);\n\nexport default blockRenderMap;\n","import { EditorState } from 'draft-js';\n\nconst getCurrentBlock = (editorState: EditorState) => {\n  const contentState = editorState.getCurrentContent();\n  const selection = editorState.getSelection();\n  const startKey = selection.getStartKey();\n  return contentState.getBlockForKey(startKey);\n};\n\nexport default getCurrentBlock;\n","import { EditorState } from 'draft-js';\nimport getCurrentBlock from './getCurrentBlock';\n\nconst hasSelectionInBlock = (type: string, editorState: EditorState) => {\n  const currentBlcok = getCurrentBlock(editorState);\n\n  return currentBlcok.getType() === type;\n};\n\nexport default hasSelectionInBlock;\n","import getCurrentBlock from './getCurrentBlock';\nimport hasSelectionInBlock from './hasSelectionInBlock';\nimport onTabInCode from './onTabInCode';\nimport hidePlaceholder from './hidePlaceholder';\nimport convertToState from './convertToState';\n\nconst utils = {\n  getCurrentBlock,\n  hasSelectionInBlock,\n  onTabInCode,\n  hidePlaceholder,\n  convertToState,\n};\n\nexport default utils;\n","import { KeyboardEvent } from 'react';\nimport Draft, { EditorState } from 'draft-js';\n\nconst onTabInCode = (event: KeyboardEvent<{}>, editorState: EditorState) => {\n  event.preventDefault();\n\n  const contentState = editorState.getCurrentContent();\n  const selection = editorState.getSelection();\n  const startKey = selection.getStartKey();\n  const currentBlock = contentState.getBlockForKey(startKey);\n  const text = currentBlock.getText();\n\n  const indention = '  ';\n\n  let newState = null;\n\n  if (selection.isCollapsed()) {\n    newState = Draft.Modifier.insertText(contentState, selection, indention);\n  } else {\n    newState = Draft.Modifier.replaceText(contentState, selection, indention);\n  }\n\n  return Draft.EditorState.push(editorState, newState, 'insert-characters');\n};\n\nexport default onTabInCode;\n","import { EditorState } from 'draft-js';\n\nconst hidePlaceholder = (editorState: EditorState) => {\n  const contentState = editorState.getCurrentContent();\n\n  if (!contentState.hasText()) {\n    return (\n      contentState\n        .getBlockMap()\n        .first()\n        .getType() !== 'unstyled'\n    );\n  }\n\n  return false;\n};\nexport default hidePlaceholder;\n","import {\n  convertFromHTML,\n  ContentState,\n  convertFromRaw,\n  EditorState,\n} from 'draft-js';\n\nconst convertToState = (content: string) => {\n  try {\n    const block = JSON.parse(content);\n    console.log(block);\n    return EditorState.createWithContent(convertFromRaw(block));\n  } catch (e) {\n    const blocksFromHTML = convertFromHTML(content);\n    const state = ContentState.createFromBlockArray(\n      blocksFromHTML.contentBlocks,\n      blocksFromHTML.entityMap\n    );\n    return EditorState.createWithContent(state);\n  }\n};\n\nexport default convertToState;\n","import { ContentBlock } from 'draft-js';\n\nconst blockStyleFn = (contentBlock: ContentBlock) => {\n  const type = contentBlock.getType();\n\n  if (type === 'blockquote') {\n    return 'myeditor-blockquote';\n  }\n\n  return '';\n};\n\nexport default blockStyleFn;\n","import React from 'react';\nimport { ContentBlock } from 'draft-js';\nimport Code from '../BlockRenderMap/Code';\n\nconst blockRenderer = (contentBlock: ContentBlock) => {\n  const type = contentBlock.getType();\n  const text = contentBlock.getText();\n\n  if (type === 'code-block') {\n    // return {\n    //   component: Code,\n    //   editable: true,\n    //   props: {\n    //     children: text,\n    //   },\n    // };\n  }\n};\n\nexport default blockRenderer;\n","import React, {\n  useState,\n  useRef,\n  useEffect,\n  SyntheticEvent,\n  useCallback,\n  KeyboardEvent,\n} from 'react';\nimport {\n  Editor,\n  EditorState,\n  DraftHandleValue,\n  RichUtils,\n  convertToRaw,\n  RawDraftContentState,\n  convertFromRaw,\n} from 'draft-js';\nimport Prismjs from 'prismjs';\nimport 'prismjs/themes/prism-tomorrow.css';\nimport classnames from 'classnames';\nimport { getSelectionRange } from './helpers';\nimport StyleControls from './StyleControls';\nimport decorators from './Decorator';\nimport blockRenderMap from './BlockRenderMap';\nimport utils from './utils';\nimport blockStyleFn from './BlockStyleFn';\nimport 'draft-js/dist/Draft.css';\nimport blockRenderer from './BlockRenderer';\nimport './style.scss';\n\nexport interface LantingEditorProps {\n  readOnly?: boolean;\n  rawContent?: string;\n  onChange?: (rawContent: RawDraftContentState) => void;\n}\n\ninterface Position {\n  x: number;\n  y: number;\n}\n\nconst LantingEditor: React.FC<LantingEditorProps> = ({\n  rawContent,\n  onChange,\n}) => {\n  const editorRef = useRef<Editor>(null);\n  const EmptyState = EditorState.createEmpty(decorators);\n  const [readOnly, setReadOnly] = useState(false);\n  const [showInlineTool, setShowInlineTool] = useState(false);\n  const [inlineToolPos, setInlineToolPos] = useState<Position>({ x: 0, y: 0 });\n  const [editorState, setEditorState] = useState<EditorState>(EmptyState);\n\n  useEffect(() => {\n    if (!readOnly) {\n      focusEditor();\n    }\n    Prismjs.highlightAll();\n  }, []);\n\n  useEffect(() => {\n    console.log(rawContent);\n    if (rawContent) {\n      setEditorState(utils.convertToState(rawContent));\n    }\n  }, [rawContent]);\n\n  const focusEditor = () => editorRef.current && editorRef.current.focus();\n\n  const handleStateChange = (editorState: EditorState) => {\n    const rawContent = convertToRaw(editorState.getCurrentContent());\n    setEditorState(editorState);\n    if (onChange) {\n      onChange(rawContent);\n    }\n  };\n\n  const handleKeyCommand = (\n    command: string,\n    editorState: EditorState\n  ): DraftHandleValue => {\n    const newState = RichUtils.handleKeyCommand(editorState, command);\n\n    if (newState) {\n      setEditorState(newState);\n      return 'handled';\n    }\n    return 'not-handled';\n  };\n\n  const getSelectionCoords = () => {\n    const selectionRange = getSelectionRange();\n    const editorBounds = document\n      .getElementById('lanting-editor')\n      ?.getBoundingClientRect();\n\n    if (\n      selectionRange &&\n      selectionRange.startOffset !== selectionRange.endOffset &&\n      editorBounds\n    ) {\n      const selectionBounds = selectionRange.getBoundingClientRect();\n\n      const x = (selectionBounds.right + selectionBounds.left) / 2;\n      const y = selectionBounds.top - 48;\n\n      return { x, y };\n    }\n\n    return null;\n  };\n\n  const handleMouseUp = useCallback((event: SyntheticEvent<HTMLElement>) => {\n    const pos = getSelectionCoords();\n\n    // if (pos) {\n    //   setInlineToolPos(pos)\n    //   setShowInlineTool(true)\n    // } else {\n    //   setShowInlineTool(false)\n    // }\n  }, []);\n\n  const handleFocus = (event: SyntheticEvent<HTMLDivElement>) => {\n    document.addEventListener(\n      'selectionchange',\n      (handleMouseUp as unknown) as EventListener\n    );\n  };\n\n  const handleBlur = (event: SyntheticEvent<HTMLDivElement>) => {\n    document.removeEventListener(\n      'selectionchange',\n      (handleMouseUp as unknown) as EventListener\n    );\n  };\n\n  const onTab = (event: React.KeyboardEvent) => {\n    if (utils.hasSelectionInBlock('code-block', editorState)) {\n      handleStateChange(utils.onTabInCode(event, editorState));\n    }\n  };\n\n  const handleReturn = (\n    event: KeyboardEvent,\n    editorState: EditorState\n  ): DraftHandleValue => {\n    const currentBlock = utils.getCurrentBlock(editorState);\n\n    if (['blockquote', 'code-block'].includes(currentBlock.getType())) {\n      handleStateChange(RichUtils.insertSoftNewline(editorState));\n      return 'handled';\n    }\n\n    return 'not-handled';\n  };\n\n  return (\n    <div\n      className={classnames('lanting-editor', {\n        'lanting-editor-hideplaceholder': utils.hidePlaceholder(editorState),\n      })}\n      id='lanting-editor'\n    >\n      {!readOnly && (\n        <StyleControls onChange={handleStateChange} editorState={editorState} />\n      )}\n      <Editor\n        ref={editorRef}\n        readOnly={readOnly}\n        placeholder='Your Story'\n        onChange={handleStateChange}\n        editorState={editorState}\n        onFocus={handleFocus}\n        onBlur={handleBlur}\n        onTab={onTab}\n        blockRenderMap={blockRenderMap}\n        blockRendererFn={blockRenderer}\n        blockStyleFn={blockStyleFn}\n        handleKeyCommand={handleKeyCommand}\n        handleReturn={handleReturn}\n      />\n    </div>\n  );\n};\n\nexport default LantingEditor;\n","export const getSelectionRange = () => {\n  const selection = window.getSelection();\n\n  if (selection && selection.rangeCount === 1) {\n    return selection.getRangeAt(0);\n  }\n\n  return null;\n};\n","import React from 'react';\nimport './style.scss';\nimport LantingEditor from 'components/LantingEditor';\n\ninterface EditProps {}\n\nconst Edit: React.FC<EditProps> = () => {\n  return (\n    <div className='edit'>\n      <LantingEditor />\n    </div>\n  );\n};\n\nexport default Edit;\n","import React, { useMemo } from 'react';\nimport classNames from 'classnames';\nimport './style.scss';\nimport { Link, useLocation } from 'react-router-dom';\nimport Icon from 'components/Icon';\n\ninterface NavProps {}\n\nconst Nav: React.FC<NavProps> = () => {\n  const { pathname } = useLocation();\n\n  const isEditPage = useMemo(() => {\n    return pathname === '/edit';\n  }, [pathname]);\n\n  return (\n    <div className={classNames(`lanting-nav`)}>\n      <div className='lanting-nav-inner'>\n        <div className='lanting-nav-title'>\n          <Link to='/' className='lanting-nav-link'>\n            <h2 className='lanting-nav-name'>兰亭</h2>\n          </Link>\n          <div className='lanting-nav-bio'>流觞曲水</div>\n        </div>\n        {!isEditPage && (\n          <Link className='lanting-nav-edit' to='/edit'>\n            <Icon>edit</Icon>\n          </Link>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Nav;\n","import React, { useEffect } from 'react';\nimport { BrowserRouter, Switch, Route } from 'react-router-dom';\nimport Index from 'containers/Index';\nimport Edit from 'containers/Edit';\nimport './style.scss';\nimport Nav from 'components/Nav';\n\nfunction App() {\n  useEffect(() => {\n    localStorage.setItem('color-mode', 'light');\n  }, []);\n\n  return (\n    <div className='app'>\n      <BrowserRouter>\n        <Nav />\n\n        <Route path='/' exact component={Index} />\n        <Switch>\n          <Route path='/edit' component={Edit} />\n        </Switch>\n      </BrowserRouter>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport Apollo from 'components/Apollo';\nimport App from './containers/App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Apollo>\n      <App />\n    </Apollo>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}